{
  "metadata": {
    "name": "update-v-v1"
  },
  "spec": {
    "rootResource": "update",
    "firstStage": "debug",
    "selfDriving": true,
    "stages": {
      "update-trigger": {
        "name": "update-trigger",
        "provider": "providers.stage.http",
        "config": {
          "name": "trigger",
          "url": "http://localhost:8085/check-update",
          "method": "POST",
          "successCodes": [
            200,
            202
          ]
        },
        "stageSelector": "${{$if($eq($output(update-trigger, statusCode), 200), update, end)}}"
      },
      "update": {
        "name": "update",
        "provider": "providers.stage.http",
        "config": {
          "name": "test",
          "url": "http://localhost:8082/targets/registry/ankaios-target",
          "method": "POST",
          "headers": {
            "Authorization": "Bearer ${{$trigger(token, \"\")}}"
          },
          "successCodes": [
            200,
            202
          ]
        },
        "inputs": {
          "body": "${{$trigger(target, {})}}"
        }
      }
    }
  }
}
